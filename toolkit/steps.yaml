scf:
  slurm: 
    time: "0:05:00"
    nodes: 1
    ntasks: 28
    mem_per_cpu: "1GB"
  cmd: | 
    ulimit -s unlimited
    
    START_DIR="$(pwd)"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_scf --part dry)
    cd "$output"
    mpiexec vasp_std > log
    
    cd "$START_DIR"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_scf --part scf)
    cd "$output"
    mpiexec vasp_std > log
        
geo:
  slurm: 
    time: "0:20:00"
    nodes: 1
    ntasks: 28
    mem_per_cpu: "2GB"
  cmd: |  
    ulimit -s unlimited

    START_DIR="$(pwd)"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_geo --part dry)
    cd "$output"
    mpiexec vasp_std > log
    
    cd "$START_DIR"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_geo --part cg_opt)
    cd "$output"
    mpiexec vasp_std > log
    
    cd "$START_DIR"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_geo --part nw_opt)
    cd "$output"
    mpiexec vasp_std > log
    
    cd "$START_DIR"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_geo --part scf)
    cd "$output"
    mpiexec vasp_std > log
    
    cd "$START_DIR"
    python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_geo --part report
    
conv_test:
  slurm: 
    time: "1:30:00"
    nodes: 1
    ntasks: 28
    mem_per_cpu: "2GB"
  cmd: |  
    ulimit -s unlimited

    START_DIR="$(pwd)"
    
    mapfile -t my_paths < <(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_conv_test --part dry)
    for p in "${my_paths[@]}"; do
      cd "$p"
      echo "$p"
      mpiexec vasp_std > log
      cd "$START_DIR"
    done
    
    cd "$START_DIR"
    mapfile -t my_paths < <(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_conv_test --part cg_opt)
    for p in "${my_paths[@]}"; do
      cd "$p"
      echo "$p"
      mpiexec vasp_std > log
      cd "$START_DIR"
    done
    
    cd "$START_DIR"
    mapfile -t my_paths < <(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_conv_test --part nw_opt)
    for p in "${my_paths[@]}"; do
      cd "$p"
      echo "$p"
      mpiexec vasp_std > log
      cd "$START_DIR"
    done
    
    cd "$START_DIR"
    mapfile -t my_paths < <(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_conv_test --part scf)
    for p in "${my_paths[@]}"; do
      cd "$p"
      echo "$p"
      mpiexec vasp_std > log
      cd "$START_DIR"
    done
    
    cd "$START_DIR"
    python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_conv_test --part report

bs:
  slurm: 
    time: "0:15:00"
    nodes: 1
    ntasks: 60
    mem_per_cpu: "1GB"
  cmd: |
    ulimit -s unlimited

    START_DIR="$(pwd)"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_bs --part dry)
    cd "$output"
    mpiexec vasp_std > log
    
    cd "$START_DIR"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_bs --part bs)
    cd "$output"
    mpiexec vasp_std > log
    
    python3 $START_DIR/Postprocessing/BS_report_post.py 
    
dos:
  slurm: 
    time: "0:30:00"
    nodes: 1
    ntasks: 72
    mem_per_cpu: "2GB"
  cmd: |    
    ulimit -s unlimited

    START_DIR="$(pwd)"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_dos --part dry)
    cd "$output"
    mpiexec vasp_std > log
    
    cd "$START_DIR"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_dos --part dos)
    cd "$output"
    mpiexec vasp_std > log
    
    python3 $START_DIR/Postprocessing/DOS_report_post.py
    
scf_so:
  slurm: 
    time: "0:20:00"
    nodes: 1
    ntasks: 40
    mem_per_cpu: "1GB"
  cmd: |
    ulimit -s unlimited
    
    START_DIR="$(pwd)"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_scf_so --part dry)
    cd "$output"
    mpiexec vasp_ncl > log
    
    cd "$START_DIR"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_scf_so --part scf)
    cd "$output"
    mpiexec vasp_ncl > log
    
geo_so:
  slurm: 
    time: "1:00:00"
    nodes: 1
    ntasks: 40
    mem_per_cpu: "2GB"
  cmd: |
    ulimit -s unlimited
    
    START_DIR="$(pwd)"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_geo_so --part dry)
    cd "$output"
    mpiexec vasp_ncl > log
    
    cd "$START_DIR"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_geo_so --part cg_opt)
    cd "$output"
    mpiexec vasp_ncl > log
    
    cd "$START_DIR"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_geo_so --part nw_opt)
    cd "$output"
    mpiexec vasp_ncl > log
    
    cd "$START_DIR"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_geo_so --part scf)
    cd "$output"
    mpiexec vasp_ncl > log
    
    cd "$START_DIR"
    python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_geo_so --part report
    
bs_so:
  slurm: 
    time: "0:30:00"
    nodes: 1
    ntasks: 60
    mem_per_cpu: "2GB"
  cmd: |
    ulimit -s unlimited

    START_DIR="$(pwd)"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_bs_so --part dry)
    cd "$output"
    mpiexec vasp_ncl > log
    
    cd "$START_DIR"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_bs_so --part bs)
    cd "$output"
    mpiexec vasp_ncl > log
    
    python3 $START_DIR/Postprocessing/BS_report_post.py
    python3 $START_DIR/Postprocessing/extract_magmom.py
    
dos_so:
  slurm: 
    time: "0:02:00"
    nodes: 1
    ntasks: 72
    mem_per_cpu: "4GB"
  cmd: |
    ulimit -s unlimited    

    START_DIR="$(pwd)"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_dos_so --part dry)
    cd "$output"
    mpiexec vasp_ncl > log
    
    cd "$START_DIR"
    output=$(python3 $START_DIR/Preprocessing/toolkit.py --input "$INPUT" --step t_dos_so --part dos)
    cd "$output"
    mpiexec vasp_ncl > log
    
    python3 $START_DIR/Postprocessing/DOS_report_post.py
    python3 $START_DIR/Postprocessing/extract_magmom.py
    
test_1:
  cmd:
    sleep 1000
test_2:
  cmd:
    sleep 1000
